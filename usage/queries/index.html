
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/google/garf/usage/queries/">
      
      
        <link rel="prev" href="../core/">
      
      
        <link rel="next" href="../api-client/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Queries - Garf</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Google Sans";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="white">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-write-queries" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Garf" class="md-header__button md-logo" aria-label="Garf" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Garf
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Queries
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="white"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="white"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/google/garf" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    garf
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Garf" class="md-nav__button md-logo" aria-label="Garf" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Garf
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/google/garf" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    garf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../get-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tutorial
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Usage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Usage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Core
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Queries
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Queries
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Elements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Elements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aliases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aliases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-indices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Indices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual Columns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Macros
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macros-in-virtual-columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Macros in virtual columns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common macros
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Templates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-queries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Built-in queries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#queries-as-python-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        Queries as Python objects
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Queries as Python objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#as-strings" class="md-nav__link">
    <span class="md-ellipsis">
      
        As strings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        As files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="As files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    <span class="md-ellipsis">
      
        Local
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remote
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-dataclasses" class="md-nav__link">
    <span class="md-ellipsis">
      
        As dataclasses
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-pydantic-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        As Pydantic objects
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-plain-python-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        As plain python classes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Clients
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fetcher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fetchers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../parsers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Parsers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../reports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Report
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Writers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Writers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/console-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Console
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/csv-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CSV
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/json-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Json
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/bq-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BigQuery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/sql-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/sheets-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Sheets
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/excel-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Excel
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/pubsub-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google PubSub
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/kafka-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Kafka
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/elasticsearch-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ElasticSearch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../writers/opensearch-writer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenSearch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Executors
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Executors
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../executors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../executors/api-executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../executors/bq-executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BigQuery
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../executors/sql-executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../executors/duckdb-executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DuckDB
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../executors/opensearch-executor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OpenSearch
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exporters/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Exporters
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../workflows/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Workflows
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/create-api-client/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create API client
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/create-api-response-parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create API response parser
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/create-garf-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create a library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Fetchers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Fetchers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fetchers/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fetchers/rest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    REST
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fetchers/youtube/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    YouTube
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fetchers/merchant-center-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Merchant Center
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fetchers/google-analytics-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Analytics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fetchers/bid-manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bid Manager
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fetchers/google-ads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Google Ads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Elements
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Elements">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aliases" class="md-nav__link">
    <span class="md-ellipsis">
      
        Aliases
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nested-resources" class="md-nav__link">
    <span class="md-ellipsis">
      
        Nested Resources
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-indices" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resource Indices
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Virtual Columns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Macros
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Macros">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#macros-in-virtual-columns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Macros in virtual columns
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#common-macros" class="md-nav__link">
    <span class="md-ellipsis">
      
        Common macros
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#templates" class="md-nav__link">
    <span class="md-ellipsis">
      
        Templates
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#built-in-queries" class="md-nav__link">
    <span class="md-ellipsis">
      
        Built-in queries
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#queries-as-python-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        Queries as Python objects
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Queries as Python objects">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#as-strings" class="md-nav__link">
    <span class="md-ellipsis">
      
        As strings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-files" class="md-nav__link">
    <span class="md-ellipsis">
      
        As files
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="As files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local" class="md-nav__link">
    <span class="md-ellipsis">
      
        Local
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remote" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remote
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-dataclasses" class="md-nav__link">
    <span class="md-ellipsis">
      
        As dataclasses
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-pydantic-objects" class="md-nav__link">
    <span class="md-ellipsis">
      
        As Pydantic objects
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#as-plain-python-classes" class="md-nav__link">
    <span class="md-ellipsis">
      
        As plain python classes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      
  
  
    
    
      <li class="md-path__item">
        <a href="../core/" class="md-path__link">
          
  <span class="md-ellipsis">
    Usage
  </span>

        </a>
      </li>
    
  

    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../core/" class="md-path__link">
          
  <span class="md-ellipsis">
    Core
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="how-to-write-queries">How to write queries</h1>
<p><code>garf</code> uses SQL-like syntax to write queries.</p>
<p>There are three ways how you can define a query:</p>
<ul>
<li>in a variable</li>
<li>in a file</li>
<li>in a class (useful when you have complex parametrization and validation)</li>
</ul>
<p>This is how a generic query might look like:</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">  </span><span class="n">ad_group</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
<span class="w">  </span><span class="n">ad_group</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ad_group</span>
</code></pre></div>
<p>When running this query and saving the results we get pretty long and unreadable
column names - <code>ad_group.id</code> and <code>ad_group.name</code>.</p>
<p>Things might be more complicated if you want to extract and save such objects
as unselectable elements, complex messages and resource names.</p>
<p>In order to simplify data extraction and processing when querying data from API
we introduce additional syntax (see an example below):</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">resource</span><span class="p">.</span><span class="n">attribute</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">column_name_1</span><span class="p">,</span>
<span class="w">    </span><span class="n">resource</span><span class="p">.</span><span class="n">attribute</span><span class="p">:</span><span class="n">nested</span><span class="p">.</span><span class="n">resource</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">column_name_3</span>
<span class="w">    </span><span class="n">resource</span><span class="p">.</span><span class="n">attribute</span><span class="o">~</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">column_name_4</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">resource</span>
</code></pre></div>
<h2 id="elements">Elements</h2>
<ul>
<li>Aliases (<code>AS column_name</code>)</li>
<li>Nested resources (<code>:nested.resource.name</code>)</li>
<li>Resource indices (<code>~position</code>)</li>
<li>Virtual columns (<code>metric.name / metric.name_2 AS alias</code>)</li>
</ul>
<h3 id="aliases">Aliases</h3>
<p>Alias is used to give a descriptive name to a metric or attribute fetched from
API when saving data. So instead of column name
<code>campaign.app_campaign_setting.bidding_strategy_goal_type</code> you may use something
more user friendly, like <code>bidding_type</code>.</p>
<p>Aliases are specified using <code>AS</code> keyword as shown below:</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">campaign</span><span class="p">.</span><span class="n">app_campaign_setting</span><span class="p">.</span><span class="n">bidding_strategy_goal_type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bidding_type</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">campaign</span>
</code></pre></div>
<p>If you don't specify an alias it will be generated as full column name where "." replaced with "_".</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>If you don't want to include a field into a response but a concrete API
requires it to be included in request you can ignore it with <code>_</code> for a
for a column name.</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">  </span><span class="n">column_1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">_</span><span class="p">,</span>
<span class="w">  </span><span class="n">column_2</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">resource</span>
</code></pre></div>
</div>
<h3 id="nested-resources">Nested Resources</h3>
<p>Some fields return structs, and if you want to get a nested attribute scalar value you can use nested resource selectors.
One particular example is working with <code>change_event</code> - <code>change_event.new_resource</code>
consists of various changes made to an entity and looks something like that:</p>
<div class="language-json highlight"><pre><span></span><code><span class="kc">ne</span><span class="err">w_resource</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">campaig</span><span class="kc">n</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">_cpa</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kc">tar</span><span class="err">ge</span><span class="kc">t</span><span class="err">_cpa_micros</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>In order to extract a particular element (i.e., final value for <code>target_cpa_micros</code>)
we use the <code>:</code> syntax - <code>change_event.new_resource:campaign.target_cpa.target_cpas_micros</code>:</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">change_event</span><span class="p">.</span><span class="n">old_resource</span><span class="p">:</span><span class="n">campaign</span><span class="p">.</span><span class="n">target_cpa</span><span class="p">.</span><span class="n">target_cpa_micros</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">old_target_cpa</span><span class="p">,</span>
<span class="w">    </span><span class="n">change_event</span><span class="p">.</span><span class="n">new_resource</span><span class="p">:</span><span class="n">campaign</span><span class="p">.</span><span class="n">target_cpa</span><span class="p">.</span><span class="n">target_cpa_micros</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">new_target_cpa</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">change_event</span>
</code></pre></div>
<h3 id="resource-indices">Resource Indices</h3>
<p>Resource indices are used to extract a particular element from data type
<em>RESOURCE_NAME</em>. I.e., if we want to get resource name for <code>campaign_audience_view.resource_name</code>
and save it somewhere, the saved result will contain a string <em>customers/{customer_id}/campaignAudienceViews/{campaign_id}~{criterion_id}</em>.
Usually we want to get only the last element from (<code>criterion_id</code>) and
it can be extracted with <code>~N</code> syntax  where <em>N</em> is a position of an element you want to extract
(indexing is starting from 0).</p>
<p>If the resource you're selecting looks like this <code>customers/111/campaignAudienceViews/222~333</code>
you can specify <code>campaign_audience_view.resource_name~1</code> to extract the second element (<code>333</code>).
If you specify <code>campaign_audience_view.resource_name~0</code> you'll get '222' (the last resource id before ~).</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">campaign_audience_view</span><span class="p">.</span><span class="n">resource_name</span><span class="o">~</span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">criterion_id</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">campaign_audience_view</span>
</code></pre></div>
<h3 id="virtual-columns">Virtual Columns</h3>
<p>Virtual columns allow to specify in a query some fields or expressions that are not present in an API.</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">counter</span><span class="p">,</span>
<span class="w">    </span><span class="n">metrics</span><span class="p">.</span><span class="n">clicks</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">metrics</span><span class="p">.</span><span class="n">impressions</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">ctr</span><span class="p">,</span>
<span class="w">    </span><span class="n">metrics</span><span class="p">.</span><span class="n">cost_micros</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">e6</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cost</span><span class="p">,</span>
<span class="w">    </span><span class="n">campaign</span><span class="p">.</span><span class="n">app_campaign_setting</span><span class="p">.</span><span class="n">bidding_strategy_goal_type</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">bidding_type</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">campaign</span>
</code></pre></div>
<p>Virtual columns can contain <strong>constants</strong> (i.e. <code>1 AS counter</code> will add new column <code>counter</code> filled with <code>1</code>) or <strong>expressions</strong>.</p>
<p>Expressions can contain field selectors, constants and any arithmetics operations with them.
For example <code>metrics.clicks / metrics.impressions AS ctr</code> will calculate
<code>metrics.clicks / metrics.impressions</code> for each row of API response and store the results in a new column <code>ctr</code>.
For this the fields <code>metrics.clicks</code> and <code>metrics.impressions</code> will be fetched implicitly.</p>
<p>Or for example <code>campaign.target_cpa.target_cpa_micros / 1000000 AS target_cpa</code>
expression will fetch <code>campaign.target_cpa.target_cpa_micros</code> field but
return the result of its division by 1000000.</p>
<p>The query parser parses a query and remove all columns which are not simple
field accessors (i.e. contains anything except field names).
For constants columns they will be re-added into result after executing the
query. For more complex columns with expressions (i.e. some operations with
fields) the result will evaluated using the response from API.</p>
<h2 id="macros">Macros</h2>
<p>You queries can contain macros.
Macro is just a substitution in script text, i.e.</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="n">campaign</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">campaign_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">metrics</span><span class="p">.</span><span class="n">clicks</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">clicks</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">campaign</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="n">segments</span><span class="p">.</span><span class="nb">date</span><span class="w"> </span><span class="k">BETWEEN</span><span class="w"> </span><span class="ss">&quot;{start_date}&quot;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="ss">&quot;{end_date}&quot;</span>
</code></pre></div>
<p>When this query is executed it's expected that two macros <code>--macro.start_date=...</code> and <code>--macro.end_date=...</code> are supplied to <code>garf</code>.</p>
<h3 id="macros-in-virtual-columns">Macros in virtual columns</h3>
<p>Macros can be used not only in WHERE statements as in the example above but also in the SELECT statement.
In that case this macros will be expanded and then treated as a virtual column.</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="ss">&quot;{current_date}&quot;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span>
<span class="w">    </span><span class="n">campaign</span><span class="p">.</span><span class="n">id</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">campaign_id</span><span class="p">,</span>
<span class="w">    </span><span class="n">campaign_budget</span><span class="p">.</span><span class="n">budget_amount_micros</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">budget</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">campaign</span>
</code></pre></div>
<p>This will return all campaign budgets and attach current date (i.e. 2023-06-01) as a date column in the output.</p>
<h3 id="common-macros">Common macros</h3>
<p><code>garf</code> by default has several common macros:</p>
<ul>
<li><code>date_iso</code> - current date in YYYYMMDD format (i.e. <em>19700101</em>)</li>
<li><code>yesterday_iso</code> - previous day date in YYYY-MM-DD format (i.e. <em>19700101</em>)</li>
<li><code>current_date</code> - current_date in YYYY-MM-DD format (i.e. <em>1970-01-01</em>)</li>
<li><code>current_datetime</code> - current datetime in YYYY-MM-DD HH:mm-ss format (i.e. <em>1970-01-01 00:00:00</em>)</li>
</ul>
<h2 id="templates">Templates</h2>
<p>Your queries can use templates using <a href="https://jinja.palletsprojects.com">Jinja</a> engine.</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">  </span><span class="n">customer_id</span><span class="w"> </span><span class="k">AS</span>
<span class="w">  </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="k">level</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="ss">&quot;0&quot;</span><span class="w">  </span><span class="o">%</span><span class="err">}</span>
<span class="w">  </span><span class="n">root_account_id</span>
<span class="w">  </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">  </span><span class="n">leaf_account_id</span>
<span class="w">  </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endif</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">dataset1</span><span class="p">.</span><span class="n">table1</span>
</code></pre></div>
<p>When this query is executed it's expected to have template <code>--template.level=...</code> is supplied to <code>garf</code>.</p>
<p>This will create a column named either <code>root_account_id</code> since the specified level is 0.</p>
<p>Template are great when you need to create multiple column based on condition:</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span>
<span class="w">    </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="k">day</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">cohort_days</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="w">        </span><span class="k">SUM</span><span class="p">(</span><span class="n">GetCohort</span><span class="p">(</span><span class="n">lag_data</span><span class="p">.</span><span class="n">installs</span><span class="p">,</span><span class="w"> </span><span class="err">{{</span><span class="k">day</span><span class="err">}}</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">installs_</span><span class="err">{{</span><span class="k">day</span><span class="err">}}</span><span class="n">_day</span><span class="p">,</span>
<span class="w">    </span><span class="err">{</span><span class="o">%</span><span class="w"> </span><span class="n">endfor</span><span class="w"> </span><span class="o">%</span><span class="err">}</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">asset_performance</span>
</code></pre></div>
<p>When this query is executed it's expected to have template <code>--template.cohort_days=0,1,3,7</code> is supplied to <code>garf</code>.</p>
<p>Please note that all values passed through CLI arguments are strings. But there's a special case - a value containing "," - it's converted to an array.
It will create 4 columns (named <code>installs_0_day</code>, <code>installs_1_day</code>, etc).</p>
<h2 id="built-in-queries">Built-in queries</h2>
<p><code>garf</code> can also works with built-in queries, which use the following syntax:</p>
<div class="language-sql highlight"><pre><span></span><code><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">builtin</span><span class="p">.</span><span class="n">builtin_query_name</span>
</code></pre></div>
<blockquote>
<p>Built-in query may or may not be provided by a particular fetcher.
Please check concrete fetcher documentation.</p>
</blockquote>
<h2 id="queries-as-python-objects">Queries as Python objects</h2>
<p>You can define queries in multiple ways.</p>
<h3 id="as-strings">As strings</h3>
<div class="language-python highlight"><pre><span></span><code><span class="n">query_string</span> <span class="o">=</span> <span class="s2">&quot;SELECT campaign.id FROM campaign&quot;</span>
</code></pre></div>
<h3 id="as-files">As files</h3>
<h4 id="local">Local</h4>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">garf.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">reader</span>

<span class="n">query_path</span> <span class="o">=</span> <span class="s2">&quot;path/to/query.sql&quot;</span>

<span class="c1"># Instantiate reader</span>
<span class="n">reader_client</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">FileReader</span><span class="p">()</span>
<span class="c1"># And read from the path</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">reader_client</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">query_path</span><span class="p">)</span>
</code></pre></div>
<h4 id="remote">Remote</h4>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">garf.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">reader</span>

<span class="n">query_path</span> <span class="o">=</span> <span class="s2">&quot;gs://PROJECT_ID/path/to/query.sql&quot;</span>

<span class="c1"># Instantiate reader</span>
<span class="n">reader_client</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">FileReader</span><span class="p">()</span>
<span class="c1"># And read from the path</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">reader_client</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">query_path</span><span class="p">)</span>
</code></pre></div>
<h3 id="as-dataclasses">As dataclasses</h3>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">garf.core.base_query</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseQuery</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Campaigns</span><span class="p">(</span><span class="n">BaseQuery</span><span class="p">):</span>
  <span class="n">query_text</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">      campaign.id</span>
<span class="s2">    FROM campaign</span>
<span class="s2">    WHERE campaign.status = </span><span class="si">{status}</span>
<span class="s2">    &quot;&quot;&quot;</span>
  <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ENABLED&quot;</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">Campaigns</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;DISABLED&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="as-pydantic-objects">As Pydantic objects</h3>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">ClassVar</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">garf.core.base_query</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseQuery</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Campaigns</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">,</span> <span class="n">BaseQuery</span><span class="p">):</span>
  <span class="n">query_text</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">      campaign.id</span>
<span class="s2">    FROM campaign</span>
<span class="s2">    WHERE campaign.status = </span><span class="si">{status}</span>
<span class="s2">    &quot;&quot;&quot;</span>
  <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ENABLED&quot;</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">Campaigns</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;DISABLED&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="as-plain-python-classes">As plain python classes</h3>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">garf.core.base_query</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseQuery</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Campaigns</span><span class="p">(</span><span class="n">BaseQuery</span><span class="p">):</span>
  <span class="n">query_text</span>  <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    SELECT</span>
<span class="s2">      campaign.id</span>
<span class="s2">    FROM campaign</span>
<span class="s2">    WHERE campaign.status = </span><span class="si">{status}</span>
<span class="s2">    &quot;&quot;&quot;</span>

  <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">Campaigns</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;DISABLED&#39;</span><span class="p">)</span>
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../core/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Overview
              </div>
            </div>
          </a>
        
        
          
          <a href="../api-client/" class="md-footer__link md-footer__link--next" aria-label="Next: API Clients">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                API Clients
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright Google 2026
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.footer", "navigation.tracking", "navigation.top", "navigation.path", "content.code.annotate", "content.code.select", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>